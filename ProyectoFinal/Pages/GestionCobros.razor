@page "/gestion_cobros"

<h3>Gestión de cobros</h3>

<button class="btn btn-info" @onclick="listaCobros">Listar</button>

<br />

<table class="table">

    <tr>
        <th>ID</th>
        <th>Reserva</th>
        <th>Monto</th>
        <th>Pagado</th>
    </tr>

    @foreach (var c in cobros)
    {
        <tr>
            <td>@c.ID_PAYMENT</td>
            <td>@c.RESERVATION</td>
            <td>@c.BILL</td>
            <td>@c.PAYED</td>
        </tr>
    }

</table>

<br />

<hr />

<h4>Pagar</h4>
<br />
<br />
<input type="number" placeholder="Id del pago" @bind-value="id_pago"/>
<br />
<br />
<input type="number" placeholder="Cantidad a pagar" @bind-value="pago" />
<br />
<br />
<button class="btn btn-secondary" @onclick="pagar">Realizar pago</button>

@code {

    string id_pago;
    int pago;

    List<Cobros> cobros = new List<Cobros>();

    public void listaCobros()
    {

        String API = $"https://pruebasv4.herokuapp.com/getAllPaymets";

        WebClient cliente = new WebClient();

        var datos = cliente.DownloadString(API);

        cobros = JsonConvert.DeserializeObject<List<Cobros>>(datos);

    }

    public async Task pagar()
    {
        var http = new HttpClient();

        var a_pagar = new Pago
        {
           PaymentId = id_pago,
           Pay = pago
        };

        var jsonBody = JsonConvert.SerializeObject(a_pagar);
        var buffer = Encoding.UTF8.GetBytes(jsonBody);
        var byteContent = new ByteArrayContent(buffer);
        byteContent.Headers.ContentType = new MediaTypeHeaderValue("application/json");

        var response = await http.PostAsync("https://pruebasv4.herokuapp.com/updatePayment", byteContent);
    }

    public class Cobros
    {

        public int ID_PAYMENT { get; set; }
        public int RESERVATION { get; set; }
        public double BILL { get; set; }
        public int PAYED { get; set; }

    }

    public class Pago
    {
        public string PaymentId { get; set; }
        public int Pay { get; set; }
    }

}
